<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Gonna lift em all · fliqqs
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Fliqqs">
<meta name="description" content="For this challenge we are given two files.
chall.py
from Crypto.Util.number import bytes_to_long, getPrime import random  FLAG = b&#39;HTB{??????????????????????????????????????????????????????????????????????}&#39;  def gen_params():  p = getPrime(1024)  g = random.randint(2, p-2)  x = random.randint(2, p-2)  h = pow(g, x, p)  return (p, g, h), x  def encrypt(pubkey):  p, g, h = pubkey  m = bytes_to_long(FLAG)  y = random.randint(2, p-2)  s = pow(h, y, p)  return (g * y % p, m * s % p)  def main():  pubkey, privkey = gen_params()  c1, c2 = encrypt(pubkey)   with open(&#39;data.">
<meta name="keywords" content="blog,developer,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Gonna lift em all"/>
<meta name="twitter:description" content="For this challenge we are given two files.
chall.py
from Crypto.Util.number import bytes_to_long, getPrime import random  FLAG = b&#39;HTB{??????????????????????????????????????????????????????????????????????}&#39;  def gen_params():  p = getPrime(1024)  g = random.randint(2, p-2)  x = random.randint(2, p-2)  h = pow(g, x, p)  return (p, g, h), x  def encrypt(pubkey):  p, g, h = pubkey  m = bytes_to_long(FLAG)  y = random.randint(2, p-2)  s = pow(h, y, p)  return (g * y % p, m * s % p)  def main():  pubkey, privkey = gen_params()  c1, c2 = encrypt(pubkey)   with open(&#39;data."/>

<meta property="og:title" content="Gonna lift em all" />
<meta property="og:description" content="For this challenge we are given two files.
chall.py
from Crypto.Util.number import bytes_to_long, getPrime import random  FLAG = b&#39;HTB{??????????????????????????????????????????????????????????????????????}&#39;  def gen_params():  p = getPrime(1024)  g = random.randint(2, p-2)  x = random.randint(2, p-2)  h = pow(g, x, p)  return (p, g, h), x  def encrypt(pubkey):  p, g, h = pubkey  m = bytes_to_long(FLAG)  y = random.randint(2, p-2)  s = pow(h, y, p)  return (g * y % p, m * s % p)  def main():  pubkey, privkey = gen_params()  c1, c2 = encrypt(pubkey)   with open(&#39;data." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.example.com/posts/gonna_lift_em_all/gonna_lift_em_all/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-05T16:56:10+10:00" />
<meta property="article:modified_time" content="2022-11-05T16:56:10+10:00" />





<link rel="canonical" href="http://www.example.com/posts/gonna_lift_em_all/gonna_lift_em_all/">


<link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.65236a6d834b26194eed04a2a3b45e44d9194ef9e620253705d4bef03bd7ef81.css" integrity="sha256-ZSNqbYNLJhlO7QSio7ReRNkZTvnmICU3BdS&#43;8DvX74E=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.f6534b0b446b75d9b6ad77a97d43ede2ddaeff1b6e2361fb7198d6f8fcb7f83f.css" integrity="sha256-9lNLC0Rrddm2rXepfUPt4t2u/xtuI2H7cZjW&#43;Py3&#43;D8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-dark">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      fliqqs
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Blog</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://www.example.com/posts/gonna_lift_em_all/gonna_lift_em_all/">
              Gonna lift em all
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime="2022-11-05T16:56:10&#43;10:00">
                November 5, 2022
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              4-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/hack-the-boo/">hack the boo</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/crypto/">crypto</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>For this challenge we are given two files.</p>
<p>chall.py</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">from</span> Crypto.Util.number <span style="color:#fff;font-weight:bold">import</span> bytes_to_long, getPrime
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> random
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FLAG = <span style="color:#0ff;font-weight:bold">b</span><span style="color:#0ff;font-weight:bold">&#39;HTB{??????????????????????????????????????????????????????????????????????}&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> gen_params():
</span></span><span style="display:flex;"><span>  p = getPrime(<span style="color:#ff0;font-weight:bold">1024</span>)
</span></span><span style="display:flex;"><span>  g = random.randint(<span style="color:#ff0;font-weight:bold">2</span>, p-<span style="color:#ff0;font-weight:bold">2</span>)
</span></span><span style="display:flex;"><span>  x = random.randint(<span style="color:#ff0;font-weight:bold">2</span>, p-<span style="color:#ff0;font-weight:bold">2</span>)
</span></span><span style="display:flex;"><span>  h = <span style="color:#fff;font-weight:bold">pow</span>(g, x, p)
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> (p, g, h), x
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> encrypt(pubkey):
</span></span><span style="display:flex;"><span>  p, g, h = pubkey
</span></span><span style="display:flex;"><span>  m = bytes_to_long(FLAG)
</span></span><span style="display:flex;"><span>  y = random.randint(<span style="color:#ff0;font-weight:bold">2</span>, p-<span style="color:#ff0;font-weight:bold">2</span>)
</span></span><span style="display:flex;"><span>  s = <span style="color:#fff;font-weight:bold">pow</span>(h, y, p)
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">return</span> (g * y % p, m * s % p)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> main():
</span></span><span style="display:flex;"><span>  pubkey, privkey = gen_params()
</span></span><span style="display:flex;"><span>  c1, c2 = encrypt(pubkey)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">with</span> <span style="color:#fff;font-weight:bold">open</span>(<span style="color:#0ff;font-weight:bold">&#39;data.txt&#39;</span>, <span style="color:#0ff;font-weight:bold">&#39;w&#39;</span>) <span style="color:#fff;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>    f.write(<span style="color:#0ff;font-weight:bold">f</span><span style="color:#0ff;font-weight:bold">&#39;p = </span><span style="color:#0ff;font-weight:bold">{</span>pubkey[<span style="color:#ff0;font-weight:bold">0</span>]<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">g = </span><span style="color:#0ff;font-weight:bold">{</span>pubkey[<span style="color:#ff0;font-weight:bold">1</span>]<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">h = </span><span style="color:#0ff;font-weight:bold">{</span>pubkey[<span style="color:#ff0;font-weight:bold">2</span>]<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">(c1, c2) = (</span><span style="color:#0ff;font-weight:bold">{</span>c1<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">, </span><span style="color:#0ff;font-weight:bold">{</span>c2<span style="color:#0ff;font-weight:bold">}</span><span style="color:#0ff;font-weight:bold">)</span><span style="color:#0ff;font-weight:bold">\n</span><span style="color:#0ff;font-weight:bold">&#39;</span>)
</span></span></code></pre></div><p>data.txt</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>p = <span style="color:#ff0;font-weight:bold">163096280281091423983210248406915712517889481034858950909290409636473708049935881617682030048346215988640991054059665720267702269812372029514413149200077540372286640767440712609200928109053348791072129620291461211782445376287196340880230151621619967077864403170491990385250500736122995129377670743204192511487</span>
</span></span><span style="display:flex;"><span>g = <span style="color:#ff0;font-weight:bold">90013867415033815546788865683138787340981114779795027049849106735163065530238112558925433950669257882773719245540328122774485318132233380232659378189294454934415433502907419484904868579770055146403383222584313613545633012035801235443658074554570316320175379613006002500159040573384221472749392328180810282909</span>
</span></span><span style="display:flex;"><span>h = <span style="color:#ff0;font-weight:bold">36126929766421201592898598390796462047092189488294899467611358820068759559145016809953567417997852926385712060056759236355651329519671229503584054092862591820977252929713375230785797177168714290835111838057125364932429350418633983021165325131930984126892231131770259051468531005183584452954169653119524751729</span>
</span></span><span style="display:flex;"><span>(c1, c2) = (<span style="color:#ff0;font-weight:bold">159888401067473505158228981260048538206997685715926404215585294103028971525122709370069002987651820789915955483297339998284909198539884370216675928669717336010990834572641551913464452325312178797916891874885912285079465823124506696494765212303264868663818171793272450116611177713890102083844049242593904824396</span>, <span style="color:#ff0;font-weight:bold">119922107693874734193003422004373653093552019951764644568950336416836757753914623024010126542723403161511430245803749782677240741425557896253881748212849840746908130439957915793292025688133503007044034712413879714604088691748282035315237472061427142978538459398404960344186573668737856258157623070654311038584</span>)
</span></span></code></pre></div><p>So we are given the method to encrypt the flag and some of the values used along the way. My first thought was we could do some brute force. In particular this line &ldquo;h = pow(g, x, p)&rdquo;. So I wrote something to try and start guessing.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">for</span> x in <span style="color:#fff;font-weight:bold">range</span> (<span style="color:#ff0;font-weight:bold">2</span>, p-<span style="color:#ff0;font-weight:bold">2</span>):
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">if</span> <span style="color:#fff;font-weight:bold">pow</span>(x,y,p) == h:
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">print</span>(x)
</span></span></code></pre></div><p>After waiting a while and doing some research I realised that guessing the exponent was going to take a very long time and would not yeild any results. As this is what makes RSA secure I thought there must be some other weakness to exploit. The next day with a fresh pair of eyes I saw this line.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">return</span> (g * y % p, m * s % p)
</span></span></code></pre></div><p>This difference is that this line just uses multiplication not exponents. This output is stored in values c1, c2 which are given to us:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>c1, c2 = encrypt(pubkey)
</span></span></code></pre></div><p>Given that we have c1, g and p maybe we could calulate y. For readability I will make the missing value x and fill in the rest.</p>
<p>c1 = g * x mod p</p>
<p>900138.. * x mod 163096.. = 159888..</p>
<p>After looking around I found a post asking this very question and we can solve for this missing value x with this equation:</p>
<p>x = inv(g, p) * c1 % p</p>
<h3 id="why-did-this-work">
  why did this work?
  <a class="heading-link" href="#why-did-this-work">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>For me this was magic so I thought I would try explain how this worked after doing some research. This is just my understanding so you can skip ahead if you like.</p>
<p>So we have to solve for x, we can look at this problem by doing some rearranging. We are asking G multipled by what produces the same result as c1 (mod p).</p>
<p>gx ≡ c1 (mod p)</p>
<p>In normal arithmatic we would divide both sides by g to solve for x but that would not work here as we are expecting a whole number result not c1/g. So what if instead we removed the g from the equation. To simplify the problem to:</p>
<p>x = c1(mod p)</p>
<p>We could achive this by multipying both sides by the modular inverse of g which is expressed as g<!-- raw HTML omitted -->-1<!-- raw HTML omitted -->. This is some value such that  g * g<!-- raw HTML omitted -->-1<!-- raw HTML omitted --> = 1 with respect to (mod   n). This would turn our problem into.</p>
<p>(g * g<!-- raw HTML omitted -->-1<!-- raw HTML omitted -->) * x = c1 * (g<!-- raw HTML omitted -->-1<!-- raw HTML omitted -->)(mod p)</p>
<p>1 * x = c1 * (g<!-- raw HTML omitted -->-1<!-- raw HTML omitted -->)(mod p)</p>
<p>x = c1 * (g<!-- raw HTML omitted -->-1<!-- raw HTML omitted -->)(mod p)</p>
<p>There is a built in function for this so we can call inverse(g,p) to help so we can end up with the formula:</p>
<p>x = c1 * inv(g, p) % p</p>
<h3 id="back-on-topic">
  Back on topic
  <a class="heading-link" href="#back-on-topic">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>So we were able to solve for y using:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>y = inv(g, p) * c1 % p
</span></span></code></pre></div><p>This allows us to re-create the s value used in the encryption proccess:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>s = <span style="color:#fff;font-weight:bold">pow</span>(h, y, p)
</span></span></code></pre></div><p>The next step is to solve the other section of the return statement.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>m * s % p = c2
</span></span></code></pre></div><p>This is exactly like the one before so we use</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>m = inv(s, p) * c2 % p
</span></span></code></pre></div><p>Now we have m in long form so we just have to turn it back into something readable using:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">print</span>(<span style="color:#fff;font-weight:bold">bytearray</span>.fromhex(<span style="color:#fff;font-weight:bold">hex</span>(m)[<span style="color:#ff0;font-weight:bold">2</span>:]).decode())
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; HTB{b3_c4r3ful_wh3n_1mpl3m3n71n6_cryp705y573m5_1n_7h3_mul71pl1c471v3_6r0up}
</span></span></code></pre></div><p>My function for reversing is as follows.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">def</span> reverse():
</span></span><span style="display:flex;"><span>  c2 = <span style="color:#ff0;font-weight:bold">119922107693874734193003422004373653093552019951764644568950336416836757753914623024010126542723403161511430245803749782677240741425557896253881748212849840746908130439957915793292025688133503007044034712413879714604088691748282035315237472061427142978538459398404960344186573668737856258157623070654311038584</span>
</span></span><span style="display:flex;"><span>  c1 = <span style="color:#ff0;font-weight:bold">159888401067473505158228981260048538206997685715926404215585294103028971525122709370069002987651820789915955483297339998284909198539884370216675928669717336010990834572641551913464452325312178797916891874885912285079465823124506696494765212303264868663818171793272450116611177713890102083844049242593904824396</span>
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">#if a*x%b = y  solve for x inv(a,b) * y % b</span>
</span></span><span style="display:flex;"><span>  g = <span style="color:#ff0;font-weight:bold">90013867415033815546788865683138787340981114779795027049849106735163065530238112558925433950669257882773719245540328122774485318132233380232659378189294454934415433502907419484904868579770055146403383222584313613545633012035801235443658074554570316320175379613006002500159040573384221472749392328180810282909</span>
</span></span><span style="display:flex;"><span>  p = <span style="color:#ff0;font-weight:bold">163096280281091423983210248406915712517889481034858950909290409636473708049935881617682030048346215988640991054059665720267702269812372029514413149200077540372286640767440712609200928109053348791072129620291461211782445376287196340880230151621619967077864403170491990385250500736122995129377670743204192511487</span>
</span></span><span style="display:flex;"><span>  h = <span style="color:#ff0;font-weight:bold">36126929766421201592898598390796462047092189488294899467611358820068759559145016809953567417997852926385712060056759236355651329519671229503584054092862591820977252929713375230785797177168714290835111838057125364932429350418633983021165325131930984126892231131770259051468531005183584452954169653119524751729</span>
</span></span><span style="display:flex;"><span>  inv = inverse(g,p)
</span></span><span style="display:flex;"><span>  inv = inv * c1
</span></span><span style="display:flex;"><span>  y = inv % p
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">#now we have y we can re-create s</span>
</span></span><span style="display:flex;"><span>  s = <span style="color:#fff;font-weight:bold">pow</span>(h,y,p)
</span></span><span style="display:flex;"><span>  <span style="color:#007f7f">#can crack the other cipher text</span>
</span></span><span style="display:flex;"><span>  inv = inverse(s,p)
</span></span><span style="display:flex;"><span>  inv = inv * c2
</span></span><span style="display:flex;"><span>  m = inv % p
</span></span><span style="display:flex;"><span>  <span style="color:#fff;font-weight:bold">print</span>(<span style="color:#fff;font-weight:bold">bytearray</span>.fromhex(<span style="color:#fff;font-weight:bold">hex</span>(m)[<span style="color:#ff0;font-weight:bold">2</span>:]).decode())
</span></span></code></pre></div>
      </div>


      <footer>
        


        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2023
     Fliqqs 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>