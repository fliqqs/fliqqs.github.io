<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Babygame01 · fliqqs
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Fliqqs">
<meta name="description" content="Baby Game  Link to heading   For this challenge we are given a game to play
Moving to the X in the bottom right informs us that &ldquo;You win!&rdquo; and exits the program. This does not give us the flag so lets have a poke around in ghidra.
In the main function we can see we get the flag if local_aa4 is != &lsquo;\0&rsquo;. which is a local variable placed on the stack before a large buffer (local_aa0).">
<meta name="keywords" content="blog,developer,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Babygame01"/>
<meta name="twitter:description" content="Baby Game  Link to heading   For this challenge we are given a game to play
Moving to the X in the bottom right informs us that &ldquo;You win!&rdquo; and exits the program. This does not give us the flag so lets have a poke around in ghidra.
In the main function we can see we get the flag if local_aa4 is != &lsquo;\0&rsquo;. which is a local variable placed on the stack before a large buffer (local_aa0)."/>

<meta property="og:title" content="Babygame01" />
<meta property="og:description" content="Baby Game  Link to heading   For this challenge we are given a game to play
Moving to the X in the bottom right informs us that &ldquo;You win!&rdquo; and exits the program. This does not give us the flag so lets have a poke around in ghidra.
In the main function we can see we get the flag if local_aa4 is != &lsquo;\0&rsquo;. which is a local variable placed on the stack before a large buffer (local_aa0)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.example.com/posts/babygame01/babygame01/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-02T16:56:10+10:00" />
<meta property="article:modified_time" content="2023-05-02T16:56:10+10:00" />





<link rel="canonical" href="http://www.example.com/posts/babygame01/babygame01/">


<link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.65236a6d834b26194eed04a2a3b45e44d9194ef9e620253705d4bef03bd7ef81.css" integrity="sha256-ZSNqbYNLJhlO7QSio7ReRNkZTvnmICU3BdS&#43;8DvX74E=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.f6534b0b446b75d9b6ad77a97d43ede2ddaeff1b6e2361fb7198d6f8fcb7f83f.css" integrity="sha256-9lNLC0Rrddm2rXepfUPt4t2u/xtuI2H7cZjW&#43;Py3&#43;D8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-dark">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      fliqqs
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Blog</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://www.example.com/posts/babygame01/babygame01/">
              Babygame01
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime="2023-05-02T16:56:10&#43;10:00">
                May 2, 2023
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              2-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/picoctf/">picoctf</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h3 id="baby-game">
  Baby Game
  <a class="heading-link" href="#baby-game">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>For this challenge we are given a game to play</p>
<p><img src="/images/babygame01/game.png" alt="webpage"></p>
<p>Moving to the X in the bottom right informs us that &ldquo;You win!&rdquo; and exits the program. This does not give us the flag so lets have a poke around in ghidra.</p>
<p><img src="/images/babygame01/flag_condition.png" alt="webpage"></p>
<p>In the main function we can see we get the flag if local_aa4 is != &lsquo;\0&rsquo;.  which is a local variable placed on the stack before a large buffer (local_aa0).</p>
<p>Lets have a closer look at the local variables in particular local_aac is used in init_player().</p>
<p><img src="/images/babygame01/init_player.png" alt="webpage"></p>
<p>This function takes the address of local_aac and writes three ints 4, 4 and 0. To local variables:</p>
<p>Top of stack 0x00000</p>
<p>$EBP - 0xAAC = local_aac = 4</p>
<p>$EBP - 0xAA8 = local_aa8 = 4</p>
<p>$EBP - 0xAA4 = local_aa4 = 0</p>
<p>4 and 4 happens to match our starting position.</p>
<p><img src="/images/babygame01/pos.png" alt="webpage"></p>
<p>So we know that that the x, y and flag condition are right before the giant buffer which appears to be the map as its passed in via print_map(). Lets piviot our attention to the move_player function which takes a point to the first position, the pressed key and the map buffer.</p>
<p><img src="/images/babygame01/move_player.png" alt="webpage"></p>
<p>Pressing p appears to call solve round which is handy and W,A,S,D will perform some pointer arithmetic and the last line dereferences and writes our player tile to that location. Interestingly there is no out of bounds checks. So if we move to 0,0 in the grid this means we can write to local_aa0</p>
<pre><code>   +----------+ +--------+  +-------+ +------+ +---------------+            
   | local_aa4| |        |  |       | |      | | local_aa0     |            
   +----------+ +--------+  +-------+ +------+ +---------------+            
                                                                            
       -4,0       -3,0        -2,0      -1,0          0,0                   
</code></pre>
<p>If we move our position into the negatives this means we could write over other local variables such as the flag condition.</p>
<p><img src="/images/babygame01/flag.png" alt="webpage"></p>
<p>Moving to -4 , 0 results in the value being written over and us getting the flag!</p>

      </div>


      <footer>
        


        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2023
     Fliqqs 
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>